// https://jscompress.com/
var h=hyperapp.h,root=document.getElementById("root"),end=new Date("2018/1/1"),newSecond=function(){var e=new Date;return Math.floor((end-e)/1e3)},state={diff:newSecond(),message:"",safe:isPass,sec:"",messages:messages},actions={safe:function(e){return function(){return{safe:!0,sec:e}}},setMessage:function(e){return function(){return{message:e}}},addMessage:function(e){return function(s){return{messages:s.messages.concat(e)}}},countSecond:function(){return function(){return{diff:newSecond()}}},guestPassword:_.throttle(function(){app.setMessage("");var e=document.getElementById("password-input"),s=e.value;e.value="",KJUR.jws.JWS.verifyJWT(token,s,{alg:["HS256"]})?(app.setMessage("..."),$.ajax({method:"POST",data:{secret:s},success:function(e){e.success?(app.setMessage("密碼正確，炸彈被解除了！"),app.safe(s)):app.setMessage(e.message)}})):app.setMessage("密碼錯誤")},1e3),sendMessage:_.throttle(function(e){var s=document.getElementById("name-input"),n=document.getElementById("message-input"),t=JSON.stringify({alg:"HS256",typ:"JWT"}),a=JSON.stringify({name:s.value,message:n.value}),o=KJUR.jws.JWS.sign("HS256",t,a,e);$.ajax({url:"/2018bomb/messages",method:"POST",data:{token:o},success:function(e){e.success?app.addMessage(e.message):app.setMessage(e.message)}})},1e3)},view=function(e,s){var n=e.diff,t=n%60,a=Math.floor(n/60%60),o=Math.floor(n/3600),u=h("p",{class:"bomb"},h("h2",null,"距離爆炸還有"),h("span",{class:"hour"},o),h("span",{class:"minute"},a),h("span",{class:"second"},t)),c=h("p",null,h("h2",null,"炸彈已解除！"),h("p",null,"新年快樂！")),i=h("div",{class:"block-container"},h("div",null,"留言"),_.map(e.messages,function(e){return h("div",{class:"dialog"},e)}));return h("div",{class:"container"},h("i",{class:"fa fa-bomb fa-4x"}),n<=0?h("p",null,h("h2",null,"炸彈解除失敗！"),h("p",null,"新年快樂！")):e.safe?c:u,e.sec||n<=0?h("div",{class:"send-message"},h("input",{id:"name-input",placeholder:"你的ＩＤ或名稱"}),h("br"),h("input",{id:"message-input",placeholder:"留言內容"}),h("br"),h("button",{type:"button",onclick:s.sendMessage.bind(this,e.sec)},"留言")):h("form",{class:"guest-password",onsubmit:function(e){e.preventDefault(),s.guestPassword()}},h("input",{id:"password-input",type:"password",oninput:function(){app.setMessage("")}}),h("button",{type:"submit"},"猜密碼")),h("div",null,e.message),!_.isEmpty(e.messages)&&i)},app=hyperapp.app(state,actions,view,root);setInterval(app.countSecond,1e3);
